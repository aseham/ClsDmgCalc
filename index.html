<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Closers Damage Calculation</title>
  <link rel="stylesheet" href="index.css">
</head>

<body onload="Start()">
  <p class="title_text">
    Please note: This damage calculations formula is a rough calculation<br>
    and is not directly taken from the game script.<br>
    Use final calculation result only for estimation purpose.
  </p>
  <p class="spoiler">
    But of course, it's more accurate than your DPS output in your character info.
  </p>
  
  <p> <!--calculations part-->
    <div class="div_front">
      <hr>
      <table align=center>
        <tr>
          <td class="datas" valign=top>
            Base Damage
          </td>
          <td class="datas" valign=top>
            <input type=text name=dmg value=0></input>
          </td>
          <td></td>
          <td align=center valign=center colspan=6>
            Situationals
          </td>
        </tr>
        <tr>
          <td class="datas" valign=top>
            Ignore Def
          </td>
          <td class="datas" valign=top>
            <input type=text name=ignore_def value=0></input>
          </td>
          <td></td>
          <td align=center valign=center colspan=2>
            <input type=checkbox name=_aerial checked> Aerial</input>
          </td>
          <td align=center valign=center colspan=2>
            <input type=checkbox name=_back checked> Back</input>
          </td>
          <td align=center valign=center colspan=2>
            <input type=checkbox name=_chase checked> Chase</input>
          </td>
        </tr>
        <tr>
          <td class="datas" valign=top>
            Damage Bonus (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=dmg_bonus value=0></input>
          </td>
          <td></td>
          <td class="datas" valign=top>
            Aerial Damage Bonus (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=a_dmg_bonus value=0></input>
          </td>
          <td class="datas" valign=top>
            Back Damage Bonus (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=b_dmg_bonus value=0></input>
          </td>
          <td class="datas" valign=top>
            Chase Damage Bonus (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=c_dmg_bonus value=0></input>
          </td>
        </tr>
        
        <tr>
          <td class="datas" valign=top>
            Critical Rate (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=crate value=0></input>
          </td>
          <td></td>
          <td class="datas" valign=top>
            Aerial Critical Rate (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=a_crate value=0></input>
          </td>
          <td class="datas" valign=top>
            Back Critical Rate (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=b_crate value=0></input>
          </td>
          <td class="datas" valign=top>
            Chase Critical Rate (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=c_crate value=0></input>
          </td>
        </tr>
        
        <tr>
          <td class="datas" valign=top>
            Critical Damage (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=cdmg value=0></input>
          </td>
          <td></td>
          <td class="datas" valign=top>
            Aerial Critical Damage (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=a_cdmg value=0></input>
          </td>
          <td class="datas" valign=top>
            Back Critical Damage (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=b_cdmg value=0></input>
          </td>
          <td class="datas" valign=top>
            Chase Critical Damage (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=c_cdmg value=0></input>
          </td>
        </tr>
        
        <tr>
          <td class="datas" valign=top>
            Def Penetration (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=penet value=0></input>
          </td>
          <td></td>
          <td class="datas" valign=top>
            Aerial Def Penetration (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=a_penet value=0></input>
          </td>
          <td class="datas" valign=top>
            Back Def Penetration (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=b_penet value=0></input>
          </td>
          <td class="datas" valign=top>
            Chase Def Penetration (%)
          </td>
          <td class="datas" valign=top>
            <input type=text name=c_penet value=0></input>
          </td>
        </tr>
      </table>
      <hr>
      <table  align=center>
        <tr>
          <td class="datas" valign=top colspan=3>
            Total Damage Output per 100 hit, excluding Penetrations:
          </td>
          <td class="results" id="dmg_out" valign=top colspan=6>
            
          </td>
        </tr>
        <tr>
          <td class="datas" valign=top>
            Final Score:
          </td>
          <td class="results" id="score" valign=top colspan=8>
            0
          </td>
        </tr>
        
         <tr>
          <td class="datas" valign=top>
            Final Rating:
          </td>
          <td class="results" id="rating" valign=top colspan=2>
            F-
          </td>
          <td class="datas" valign=top colspan=6>
            Character:
            <select name="rate_base" id=soflow>
              <option value="Seha">Seha / ハルト</option>
              <option value="Seulbi">Seulbi / ミコト</option>
              <option value="Yuri">Yuri / ユリ</option>
              <option value="J">J / ジェイ</option>
              <option value="Misteltein">Misteltein / ミスティルティン</option>
              <option value="Nata">Nata / スラッシュ</option>
              <option value="Levia">Levia / レヴィア</option>
              <option value="Harpy">Harpy / ハーピー</option>
              <option value="Tina">Tina / チィナ</option>
              <option value="Violet">Violet / ヴァイオレット (under development)</option>
            </select>
          </td>
          
        </tr>
        <tr>
          <td class="datas" valign=top colspan=9>
            Note that same stats for different characters may have different rating because of their skills.
          </td>
        </tr>
        
      </table>
      
    </div>
  </p>
  
</body>

<script type="text/javascript">
  var base_dmg = 0;
  var crate = 0;
  var cdmg = 0;
  //aerial
  var a_dmg_bonus = 0;
  var a_crate = 0;
  var a_cdmg = 0;
  //back
  var b_dmg_bonus = 0;
  var b_crate = 0;
  var b_cdmg = 0;
  //chase
  var c_dmg_bonus = 0;
  var c_crate = 0;
  var c_cdmg = 0;
  
  var isAerial;
  var isBack;
  var isChase;
  
  var total_output;

	function Start() {
		var myVar = setInterval(dmgOut100Hit, 10);
	}
  
  function situationalCheck() {
    //aerial
    isAerial = document.getElementsByName("_aerial")[0].checked;
    document.getElementsByName("a_dmg_bonus")[0].disabled = !isAerial;
    document.getElementsByName("a_crate")[0].disabled = !isAerial;
    document.getElementsByName("a_cdmg")[0].disabled = !isAerial;
    document.getElementsByName("a_penet")[0].disabled = !isAerial;
    //back
    isBack = document.getElementsByName("_back")[0].checked;
    document.getElementsByName("b_dmg_bonus")[0].disabled = !isBack;
    document.getElementsByName("b_crate")[0].disabled = !isBack;
    document.getElementsByName("b_cdmg")[0].disabled = !isBack;
    document.getElementsByName("b_penet")[0].disabled = !isBack;
    //chase
    isChase = document.getElementsByName("_chase")[0].checked;
    document.getElementsByName("c_dmg_bonus")[0].disabled = !isChase;
    document.getElementsByName("c_crate")[0].disabled = !isChase;
    document.getElementsByName("c_cdmg")[0].disabled = !isChase;
    document.getElementsByName("c_penet")[0].disabled = !isChase;
  }
  
  function fetchData() {
		base_dmg = parseFloat(document.getElementsByName("dmg")[0].value);
    crate = parseFloat(document.getElementsByName("crate")[0].value);
    cdmg = parseFloat(document.getElementsByName("cdmg")[0].value);
    
    a_dmg_bonus = parseFloat(document.getElementsByName("a_dmg_bonus")[0].value);
    b_dmg_bonus = parseFloat(document.getElementsByName("b_dmg_bonus")[0].value);
    c_dmg_bonus = parseFloat(document.getElementsByName("c_dmg_bonus")[0].value);
    a_crate = parseFloat(document.getElementsByName("a_crate")[0].value);
    b_crate = parseFloat(document.getElementsByName("b_crate")[0].value);
    c_crate = parseFloat(document.getElementsByName("c_crate")[0].value);
    a_cdmg = parseFloat(document.getElementsByName("a_cdmg")[0].value);
    b_cdmg = parseFloat(document.getElementsByName("b_cdmg")[0].value);
    c_cdmg = parseFloat(document.getElementsByName("c_cdmg")[0].value);
  }
  
  function bool2Int(x) {
    if (x)
      return 1;
    else
      return 0;
  }
  
  function dmgOut100Hit() {
    situationalCheck();
    fetchData();
    var total_crate = Math.min((crate + bool2Int(isAerial)*a_crate + bool2Int(isBack)*b_crate + bool2Int(isChase)*c_crate),100);
    var total_cdmg = cdmg + bool2Int(isAerial)*a_cdmg + bool2Int(isBack)*b_cdmg + bool2Int(isChase)*c_cdmg;
    total_output = (base_dmg + (total_crate*0.01) * (total_cdmg*0.01) * base_dmg) * 100;
    if (isNaN(total_output))
      document.getElementById("dmg_out").innerHTML = 0;
    else
      document.getElementById("dmg_out").innerHTML = Math.round(total_output);
  }
	</script>

</html>